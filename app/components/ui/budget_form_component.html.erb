<div class="budget-form-container">
  <%= form_with(
    model: budget,
    url: url,
    method: method,
    class: "space-y-6",
    data: { controller: "budget-form" }
  ) do |f| %>
    <% if budget.errors.any? %>
      <div class="rounded-lg border border-destructive bg-destructive/10 p-4">
        <div class="font-medium text-destructive">
          Please correct the following errors:
        </div>
        <ul class="mt-2 list-disc pl-5 text-sm text-destructive">
          <% budget.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <section class="space-y-4">
      <div class="space-y-2">
        <label for="budget_budgeted_spending" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
          Budgeted spending
        </label>
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"><%= budget.currency_symbol %></span>
          <input 
            type="number" 
            name="budget[budgeted_spending]" 
            id="budget_budgeted_spending" 
            value="<%= budget.budgeted_spending %>" 
            placeholder="Enter your monthly budget"
            required
            step="0.01"
            min="0"
            class="flex w-full rounded-md border border-input bg-background pl-8 pr-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
          />
        </div>
        <p class="text-sm text-muted-foreground">The total amount you plan to spend this month</p>
      </div>

      <div class="space-y-2">
        <label for="budget_expected_income" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
          Expected income
        </label>
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"><%= budget.currency_symbol %></span>
          <input 
            type="number" 
            name="budget[expected_income]" 
            id="budget_expected_income" 
            value="<%= budget.expected_income %>" 
            placeholder="Enter your expected monthly income"
            required
            step="0.01"
            min="0"
            class="flex w-full rounded-md border border-input bg-background pl-8 pr-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
          />
        </div>
        <p class="text-sm text-muted-foreground">The total income you expect to receive this month</p>
      </div>
    </section>

    <% if budget.estimated_income && budget.estimated_spending %>
      <div class="border border-border rounded-lg p-4 flex items-center justify-between">
        <div class="flex items-start">
          <div class="text-primary mr-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"></path>
              <path d="M9 18h6"></path>
              <path d="M10 22h4"></path>
            </svg>
          </div>
          <div class="space-y-1">
            <h4 class="text-sm font-medium text-primary">Autosuggest income & spending budget</h4>
            <p class="text-xs text-muted-foreground">This will be based on transaction history. AI can make mistakes, verify before continuing.</p>
          </div>
        </div>
        <div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input 
              type="checkbox" 
              id="auto_fill" 
              class="sr-only peer"
              data-action="change->budget-form#toggleAutoFill"
              data-budget-form-income-param='<%= { key: "budget_expected_income", value: sprintf("%.2f", budget.estimated_income) }.to_json %>'
              data-budget-form-spending-param='<%= { key: "budget_budgeted_spending", value: sprintf("%.2f", budget.estimated_spending) }.to_json %>'
            >
            <div class="w-11 h-6 bg-muted rounded-full peer peer-focus:ring-2 peer-focus:ring-ring peer-checked:after:translate-x-full rtl:peer-checked:after:translate-x-[-100%] peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
          </label>
        </div>
      </div>
    <% end %>

    <div class="flex justify-end">
      <button 
        type="submit" 
        class="inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"
      >
        Continue
      </button>
    </div>
  <% end %>
</div>