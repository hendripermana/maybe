<h1 class="text-2xl font-bold mb-6">User Feedback</h1>

<div class="mb-6">
  <%= link_to "← Back to Dashboard", monitoring_path, class: "text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" %>
</div>

<div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6">
  <h2 class="text-lg font-medium mb-4">Filter Feedback</h2>
  
  <%= form_with url: monitoring_feedback_path, method: :get, class: "space-y-4" do |f| %>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <%= f.label :feedback_type, "Feedback Type", class: "block text-sm font-medium mb-1" %>
        <%= f.select :feedback_type, 
          options_for_select([["All Types", ""]] + @feedback_types.map { |t| [t.humanize, t] }, params[:feedback_type]),
          {}, 
          { class: "form-select w-full" } %>
      </div>
      
      <div>
        <%= f.label :resolved, "Status", class: "block text-sm font-medium mb-1" %>
        <%= f.select :resolved, 
          options_for_select([
            ["All Status", ""], 
            ["Resolved", "true"], 
            ["Unresolved", "false"]
          ], params[:resolved]),
          {}, 
          { class: "form-select w-full" } %>
      </div>
      
      <div>
        <%= f.label :search, "Search", class: "block text-sm font-medium mb-1" %>
        <%= f.text_field :search, value: params[:search], placeholder: "Search in feedback...", class: "form-input w-full" %>
      </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <%= f.label :start_date, "Start Date", class: "block text-sm font-medium mb-1" %>
        <%= f.date_field :start_date, value: params[:start_date], class: "form-input w-full" %>
      </div>
      
      <div>
        <%= f.label :end_date, "End Date", class: "block text-sm font-medium mb-1" %>
        <%= f.date_field :end_date, value: params[:end_date], class: "form-input w-full" %>
      </div>
    </div>
    
    <div class="flex space-x-2">
      <%= f.submit "Apply Filters", class: "px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors" %>
      <%= link_to "Clear Filters", monitoring_feedback_path, class: "px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-200 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors" %>
    </div>
  <% end %>
</div>

<div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
  <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
    <thead class="bg-gray-50 dark:bg-gray-700">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Message</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Page</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">User</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Time</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
      </tr>
    </thead>
    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
      <% if @feedback.any? %>
        <% @feedback.each do |feedback| %>
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <%= feedback.feedback_type.humanize %>
            </td>
            <td class="px-6 py-4 text-sm">
              <div class="truncate max-w-xs"><%= feedback.message %></div>
            </td>
            <td class="px-6 py-4 text-sm">
              <div class="truncate max-w-xs"><%= feedback.page %></div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <%= feedback.user ? feedback.user.email : 'Anonymous' %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <% if feedback.resolved %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100">
                  Resolved
                </span>
              <% else %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100">
                  Open
                </span>
              <% end %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              <%= feedback.created_at.strftime("%Y-%m-%d %H:%M:%S") %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <% unless feedback.resolved %>
                <%= button_to "Resolve", resolve_feedback_path(feedback), method: :post, class: "text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" %>
              <% else %>
                <span class="text-gray-400">Resolved by <%= feedback.resolved_by ? User.find_by(id: feedback.resolved_by)&.email || 'Unknown' : 'System' %></span>
              <% end %>
            </td>
          </tr>
        <% end %>
      <% else %>
        <tr>
          <td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400">
            No feedback found matching your criteria
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  
  <div class="px-6 py-3 border-t border-gray-200 dark:border-gray-700">
    <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
  </div>
</div>