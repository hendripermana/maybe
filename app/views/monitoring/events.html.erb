<h1 class="text-2xl font-bold mb-6">UI Monitoring Events</h1>

<div class="mb-6">
  <%= link_to "← Back to Dashboard", monitoring_path, class: "text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" %>
</div>

<div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6">
  <h2 class="text-lg font-medium mb-4">Filter Events</h2>
  
  <%= form_with url: monitoring_events_path, method: :get, class: "space-y-4" do |f| %>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <%= f.label :event_type, "Event Type", class: "block text-sm font-medium mb-1" %>
        <%= f.select :event_type, 
          options_for_select([["All Types", ""]] + @event_types.map { |t| [t.humanize, t] }, params[:event_type]),
          {}, 
          { class: "form-select w-full" } %>
      </div>
      
      <div>
        <%= f.label :component, "Component", class: "block text-sm font-medium mb-1" %>
        <%= f.select :component, 
          options_for_select([["All Components", ""]] + @components.map { |c| [c, c] }, params[:component]),
          {}, 
          { class: "form-select w-full" } %>
      </div>
      
      <div>
        <%= f.label :error_type, "Error Type", class: "block text-sm font-medium mb-1" %>
        <%= f.select :error_type, 
          options_for_select([["All Errors", ""]] + @error_types.map { |e| [e, e] }, params[:error_type]),
          {}, 
          { class: "form-select w-full" } %>
      </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <%= f.label :start_date, "Start Date", class: "block text-sm font-medium mb-1" %>
        <%= f.date_field :start_date, value: params[:start_date], class: "form-input w-full" %>
      </div>
      
      <div>
        <%= f.label :end_date, "End Date", class: "block text-sm font-medium mb-1" %>
        <%= f.date_field :end_date, value: params[:end_date], class: "form-input w-full" %>
      </div>
    </div>
    
    <div>
      <%= f.label :search, "Search", class: "block text-sm font-medium mb-1" %>
      <%= f.text_field :search, value: params[:search], placeholder: "Search in event data...", class: "form-input w-full" %>
    </div>
    
    <div class="flex space-x-2">
      <%= f.submit "Apply Filters", class: "px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors" %>
      <%= link_to "Clear Filters", monitoring_events_path, class: "px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-200 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors" %>
    </div>
  <% end %>
</div>

<div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
  <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
    <thead class="bg-gray-50 dark:bg-gray-700">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Type</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Details</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">User</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Browser</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Time</th>
      </tr>
    </thead>
    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
      <% if @events.any? %>
        <% @events.each do |event| %>
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <%= event.event_type %>
            </td>
            <td class="px-6 py-4 text-sm">
              <% if event.event_type == 'ui_error' %>
                <div class="font-medium"><%= event.data['error_type'] %></div>
                <div class="text-gray-500 dark:text-gray-400 truncate max-w-xs"><%= event.data['message'] %></div>
                <% if event.component_name.present? %>
                  <div class="text-xs mt-1">Component: <%= event.component_name %></div>
                <% end %>
              <% elsif event.event_type == 'performance_metric' %>
                <div><%= event.data['metric_name'] %>: <%= event.data['value'] %>ms</div>
                <% if event.data['component_name'].present? %>
                  <div class="text-xs mt-1">Component: <%= event.data['component_name'] %></div>
                <% end %>
              <% else %>
                <div class="truncate max-w-xs"><%= event.data.to_json %></div>
              <% end %>
              
              <% if event.data['url'].present? %>
                <div class="text-xs mt-1 text-gray-500 dark:text-gray-400 truncate max-w-xs">
                  URL: <%= event.data['url'] %>
                </div>
              <% end %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <%= event.user ? event.user.email : 'Anonymous' %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <%= event.browser_info %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              <%= event.created_at.strftime("%Y-%m-%d %H:%M:%S") %>
            </td>
          </tr>
        <% end %>
      <% else %>
        <tr>
          <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400">
            No events found matching your criteria
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  
  <div class="px-6 py-3 border-t border-gray-200 dark:border-gray-700">
    <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
  </div>
</div>