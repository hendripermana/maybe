<%# locals: (form:) %>

<%= render TabsComponent.new(
  variant: :unstyled,
  active_tab: get_default_transaction_search_filter[:key],
  active_btn_classes: "bg-accent text-accent-foreground",
  inactive_btn_classes: "text-muted-foreground hover:bg-accent hover:text-accent-foreground"
) do |tabs| %>
  <div id="transaction-filters-menu" 
       class="flex flex-col md:flex-row h-[50vh] lg:max-h-auto z-10 md:h-80 w-full md:w-[540px] top-12 right-0 overflow-hidden rounded-lg border border-border bg-background shadow-md"
       data-controller="focus-trap"
       data-action="keydown.escape->menu#close">
    <%= tabs.with_nav(classes: "shrink-0 flex w-full md:w-44 flex-row md:flex-col items-start p-3 text-sm font-medium border-b md:border-b-0 md:border-r border-border overflow-x-auto md:overflow-x-visible") do |nav| %>
      <% transaction_search_filters.each do |filter| %>
        <%= nav.with_btn(id: filter[:key], label: filter[:label], classes: "w-full px-3 py-2 flex gap-2 items-center rounded-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2") do %>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-muted-foreground">
            <% case filter[:icon] %>
            <% when "layers" %>
              <path d="M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/>
              <path d="m22 12-8.6 3.91a2 2 0 0 1-1.66 0L3 12"/>
              <path d="m22 17-8.6 3.91a2 2 0 0 1-1.66 0L3 17"/>
            <% when "calendar" %>
              <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
              <line x1="16" x2="16" y1="2" y2="6"/>
              <line x1="8" x2="8" y1="2" y2="6"/>
              <line x1="3" x2="21" y1="10" y2="10"/>
            <% when "tag" %>
              <path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/>
              <path d="M7 7h.01"/>
            <% when "hash" %>
              <line x1="4" x2="20" y1="9" y2="9"/>
              <line x1="4" x2="20" y1="15" y2="15"/>
              <line x1="10" x2="8" y1="3" y2="21"/>
              <line x1="16" x2="14" y1="3" y2="21"/>
            <% when "shapes" %>
              <path d="M8 3H5a2 2 0 0 0-2 2v3"/>
              <path d="M21 8V5a2 2 0 0 0-2-2h-3"/>
              <path d="M3 16v3a2 2 0 0 0 2 2h3"/>
              <path d="M16 21h3a2 2 0 0 0 2-2v-3"/>
              <circle cx="12" cy="12" r="4"/>
            <% when "tags" %>
              <path d="M9 5H2v7l6.29 6.29c.94.94 2.48.94 3.42 0l3.58-3.58c.94-.94.94-2.48 0-3.42L9 5Z"/>
              <path d="M6 9.01V9"/>
              <path d="m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19"/>
            <% when "store" %>
              <path d="M2 3h20v4H2z"/>
              <path d="M20 7v14H4V7"/>
              <path d="M2 7h20"/>
              <path d="M12 7v14"/>
            <% else %>
              <circle cx="12" cy="12" r="10"/>
            <% end %>
          </svg>
          <%= tag.span(filter[:label], class: "text-sm font-medium") %>
        <% end %>
      <% end %>
    <% end %>

    <div class="flex flex-col grow overflow-y-auto">
      <div class="grow border-b border-border overflow-y-auto">
        <% transaction_search_filters.each do |filter| %>
          <%= tabs.with_panel(tab_id: filter[:key]) do %>
            <%= render partial: get_transaction_search_filter_partial_path(filter), locals: { form: form } %>
          <% end %>
        <% end %>
      </div>

      <div class="flex justify-between items-center gap-2 p-3 shrink-0">
        <div>
          <% if @q.present? %>
            <%= render LinkComponent.new(
            text: t(".clear_filters"),
            variant: "ghost",
            href: transactions_path(clear_filters: true),
          ) %>
          <% end %>
        </div>

        <div class="flex gap-2">
          <%= render ButtonComponent.new(
            text: t(".cancel"), 
            type: "button", 
            variant: "outline", 
            data: { action: "menu#close" }
          ) %>
          <%= render ButtonComponent.new(
            text: t(".apply"),
            variant: "primary"
          ) %>
        </div>
      </div>
    </div>
  </div>
<% end %>
