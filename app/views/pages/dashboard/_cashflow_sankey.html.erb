<%# locals: (sankey_data:, period:) %>
<div id="cashflow-sankey-chart">
  <div class="flex justify-between items-center gap-4 px-4 mb-4">
    <h2 class="text-lg font-medium inline-flex items-center gap-1.5">
      Cashflow
    </h2>

    <div class="flex items-center gap-3">
      <%= form_with url: root_path, method: :get, data: { controller: "auto-submit-form", turbo_frame: "cashflow_sankey_section" } do |form| %>
        <%= form.select :cashflow_period,
                  Period.as_options,
                  { selected: period.key },
                  data: { "auto-submit-form-target": "auto" },
                  class: "bg-container border border-secondary font-medium rounded-lg px-3 py-2 text-sm pr-7 cursor-pointer text-primary focus:outline-hidden focus:ring-0" %>
      <% end %>
      
      <button 
        data-sankey-chart-target="fullscreenBtn"
        data-action="click->sankey-chart#toggleFullscreen"
        class="text-secondary hover:text-primary transition-colors duration-200 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800"
        title="Toggle fullscreen">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
        </svg>
      </button>
    </div>
  </div>

  <% if sankey_data[:links].present? %>
    <div 
      data-sankey-chart-target="container"
      class="w-full h-[500px] lg:h-[600px] relative transition-all duration-300">
      <div
        data-controller="sankey-chart"
        data-sankey-chart-data-value="<%= sankey_data.to_json %>"
        data-sankey-chart-currency-symbol-value="<%= sankey_data[:currency_symbol] %>"
        class="w-full h-full"></div>
      
      <!-- Close button for fullscreen mode -->
      <button 
        data-sankey-chart-target="closeBtn"
        data-action="click->sankey-chart#toggleFullscreen"
        class="absolute top-4 right-4 text-white hover:text-gray-300 transition-colors duration-200 p-2 rounded-full bg-black bg-opacity-50 hover:bg-opacity-70 hidden z-10"
        title="Exit fullscreen">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
  <% else %>
    <div class="h-[300px] lg:h-[340px] bg-container py-4 flex flex-col items-center justify-center">
      <div class="space-y-3 text-center flex flex-col items-center">
        <%= render FilledIconComponent.new(
          variant: :container,
          icon: "activity" # cashflow placeholder icon
        ) %>

        <p class="text-sm font-medium text-primary">No cash flow data for this time period</p>
        <p class="text-secondary text-sm">Add transactions to display cash flow data or expand the time period</p>
        <%= render LinkComponent.new(
          text: "Add transaction",
          icon: "plus",
          href: new_transaction_path,
          frame: :modal
        ) %>
      </div>
    </div>
  <% end %>
</div>
