<div data-controller="chat hotkey" class="h-full flex flex-col">
  <%= turbo_frame_tag chat_frame, class: "h-full flex flex-col" do %>
    <%= turbo_stream_from @chat %>

    <h1 class="sr-only"><%= @chat.title %></h1>

    <div class="flex flex-col h-full">
      <div class="p-4 border-b border-border bg-card">
        <%= render "chats/chat_nav", chat: @chat %>
      </div>

      <div id="messages" class="grow overflow-y-auto p-4 space-y-6 pb-24 lg:pb-4 bg-background" data-chat-target="messages">
        <% if @chat.conversation_messages.any? %>
          <% @chat.conversation_messages.ordered.each do |message| %>
            <%= render message %>
          <% end %>
        <% else %>
          <div class="mt-auto">
            <%= render "chats/ai_greeting", context: "chat" %>
          </div>
        <% end %>

        <% if params[:thinking].present? %>
          <%= render "chats/thinking_indicator", chat: @chat %>
        <% end %>

        <% if @chat.error.present? && @chat.needs_assistant_response? %>
          <%= render "chats/error", chat: @chat %>
        <% end %>
      </div>

      <div class="p-4 border-t border-border bg-card mt-auto sticky bottom-0 left-0 w-full">
        <%= render "messages/chat_form", chat: @chat %>
      </div>
    </div>
  <% end %>
</div>
