<%= content_for :page_title, t(".title") %>

<%= settings_section title: t(".general_title"), subtitle: t(".general_subtitle") do %>
  <%= render Ui::FormComponent.new(
    model: @user.family,
    data: { controller: "auto-submit-form" }
  ) do |form| %>
    <%= render Ui::FormFieldComponent.new(
      form: form,
      field: :locale,
      label: t(".language"),
      tooltip: t(".language_tooltip")
    ) do %>
      <%= render Ui::SelectComponent.new(
        form: form,
        field: :locale,
        options: language_options,
        data: { auto_submit_form_target: "auto" }
      ) %>
    <% end %>

    <%= render Ui::FormFieldComponent.new(
      form: form,
      field: :timezone,
      label: t(".timezone"),
      tooltip: t(".timezone_tooltip")
    ) do %>
      <%= render Ui::SelectComponent.new(
        form: form,
        field: :timezone,
        options: timezone_options,
        data: { auto_submit_form_target: "auto" }
      ) %>
    <% end %>

    <%= render Ui::FormFieldComponent.new(
      form: form,
      field: :date_format,
      label: t(".date_format")
    ) do %>
      <%= render Ui::SelectComponent.new(
        form: form,
        field: :date_format,
        options: Family::DATE_FORMATS,
        data: { auto_submit_form_target: "auto" }
      ) %>
    <% end %>
  <% end %>
<% end %>

<%= settings_section title: t(".theme_title"), subtitle: t(".theme_subtitle") do %>
  <%= render Ui::FormComponent.new(
    model: @user,
    html_id: "theme_form",
    data: { 
      controller: "auto-submit-form theme-auto-save", 
      auto_submit_form_trigger_event_value: "change",
      theme_auto_save_url_value: update_theme_settings_preferences_path,
      theme_auto_save_csrf_token_value: form_authenticity_token
    }
  ) do |form| %>
    <%= form.hidden_field :redirect_to, value: "preferences" %>
    
    <!-- Theme Switcher Component -->
    <%= render Ui::ThemeSwitcherComponent.new(form: form, user: @user) %>
    
    <!-- Additional Theme Preferences -->
    <div class="mt-8 border-t border-border pt-6">
      <h4 class="text-base font-medium text-primary mb-4"><%= t(".theme_additional_preferences") %></h4>
      
      <!-- High Contrast Mode -->
      <%= render Ui::FormFieldComponent.new(
        form: form,
        field: :high_contrast_mode,
        label: t(".high_contrast_mode"),
        help_text: t(".high_contrast_mode_help")
      ) do %>
        <%= render Ui::ToggleSwitchComponent.new(
          form: form,
          field: :high_contrast_mode,
          label_text: t(".enable_high_contrast"),
          data: { auto_submit_form_target: "auto" }
        ) %>
      <% end %>
      
      <!-- Reduced Motion -->
      <%= render Ui::FormFieldComponent.new(
        form: form,
        field: :reduced_motion,
        label: t(".reduced_motion"),
        help_text: t(".reduced_motion_help")
      ) do %>
        <%= render Ui::ToggleSwitchComponent.new(
          form: form,
          field: :reduced_motion,
          label_text: t(".enable_reduced_motion"),
          data: { auto_submit_form_target: "auto" }
        ) %>
      <% end %>
      
      <!-- Font Size -->
      <%= render Ui::FormFieldComponent.new(
        form: form,
        field: :font_size,
        label: t(".font_size"),
        help_text: t(".font_size_help")
      ) do %>
        <%= render Ui::SelectComponent.new(
          form: form,
          field: :font_size,
          options: [
            [t(".font_size_small"), "small"],
            [t(".font_size_medium"), "medium"],
            [t(".font_size_large"), "large"],
            [t(".font_size_extra_large"), "extra_large"]
          ],
          data: { auto_submit_form_target: "auto" }
        ) %>
      <% end %>
    </div>
  <% end %>
<% end %>

<%= settings_section title: t(".notification_title"), subtitle: t(".notification_subtitle") do %>
  <%= render Ui::FormComponent.new(
    model: @user,
    data: { controller: "auto-submit-form" }
  ) do |form| %>
    <%= render Ui::FormFieldComponent.new(
      form: form,
      field: :email_notifications,
      label: t(".email_notifications")
    ) do %>
      <%= render Ui::ToggleSwitchComponent.new(
        form: form,
        field: :email_notifications,
        label_text: t(".receive_email_notifications"),
        data: { auto_submit_form_target: "auto" }
      ) %>
    <% end %>

    <%= render Ui::FormFieldComponent.new(
      form: form,
      field: :notification_frequency,
      label: t(".notification_frequency"),
      help_text: t(".notification_frequency_help")
    ) do %>
      <%= render Ui::RadioGroupComponent.new(
        form: form,
        field: :notification_frequency,
        orientation: :vertical,
        data: { auto_submit_form_target: "auto" }
      ) do |radio_group| %>
        <% radio_group.radio_button(value: "daily", label: t(".daily"), description: t(".daily_description")) %>
        <% radio_group.radio_button(value: "weekly", label: t(".weekly"), description: t(".weekly_description")) %>
        <% radio_group.radio_button(value: "monthly", label: t(".monthly"), description: t(".monthly_description")) %>
        <% radio_group.radio_button(value: "never", label: t(".never"), description: t(".never_description")) %>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<%= settings_section title: t(".privacy_title"), subtitle: t(".privacy_subtitle") do %>
  <%= render Ui::FormComponent.new(
    model: @user,
    data: { controller: "auto-submit-form" }
  ) do |form| %>
    <%= render Ui::FormFieldComponent.new(
      form: form,
      field: :data_sharing,
      label: t(".data_sharing")
    ) do %>
      <%= render Ui::CheckboxComponent.new(
        form: form,
        field: :data_sharing,
        label_text: t(".allow_data_collection"),
        description: t(".data_collection_description"),
        data: { auto_submit_form_target: "auto" }
      ) %>
    <% end %>

    <%= render Ui::FormFieldComponent.new(
      form: form,
      field: :marketing_emails,
      label: t(".marketing_communications")
    ) do %>
      <%= render Ui::CheckboxComponent.new(
        form: form,
        field: :marketing_emails,
        label_text: t(".receive_marketing_emails"),
        data: { auto_submit_form_target: "auto" }
      ) %>
    <% end %>
  <% end %>
<% end %>