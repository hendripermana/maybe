<%# locals: (account:, url:) %>

<%= render "accounts/form", account: account, url: url do |form| %>
  <%= render "shared/ruler", classes: "my-4" %>

  <div class="space-y-2">
    <%= form.fields_for :accountable do |loan_form| %>
      <div class="flex items-center gap-2">
        <%= loan_form.select :debt_kind,
                              [["Institutional", "institutional"], ["Personal", "personal"]],
                              { label: "Debt Type" } %>
      </div>

      <div class="flex items-center gap-2">
        <%= loan_form.select :counterparty_type,
                              [["Institution", "institution"], ["Person", "person"]],
                              { label: "Counterparty Type" } %>
        <%= loan_form.text_field :counterparty_name, label: "Counterparty Name", placeholder: "e.g., BCA, Dana, John Doe" %>
      </div>

      <%# Disbursement account only when not imported. `form.object` is the Account; `loan_form.object` is the Loan. %>
      <% unless form.object.import&.present? || loan_form.object.imported %>
        <div class="flex items-center gap-2">
          <%= loan_form.collection_select :disbursement_account_id,
                                          Current.family.accounts.assets.alphabetically,
                                          :id, :name,
                                          { label: "Disbursement Account" } %>
          <%= loan_form.date_field :origination_date, label: "Origination Date", value: Date.current %>
        </div>
      <% end %>

      <div class="flex items-center gap-2">
        <%= loan_form.money_field :initial_balance,
                                 label: t("loans.form.initial_balance"),
                                 default_currency: Current.family.currency,
                                 required: true %>
      </div>

      <div class="flex items-center gap-2">
        <%= loan_form.number_field :interest_rate,
                                 label: t("loans.form.interest_rate"),
                                 placeholder: t("loans.form.interest_rate_placeholder"),
                                 min: 0,
                                 step: 0.005 %>
        <%= loan_form.select :rate_type,
                           [["Fixed", "fixed"], ["Variable", "variable"], ["Adjustable", "adjustable"]],
                           { label: t("loans.form.rate_type") } %>
      </div>

      <div class="flex items-center gap-2">
        <%= loan_form.number_field :term_months,
                                 label: t("loans.form.term_months"),
                                 placeholder: t("loans.form.term_months_placeholder") %>
      </div>
    <% end %>
  </div>
<% end %>
